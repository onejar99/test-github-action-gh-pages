name: Build and deploy gh-pages

# workflow trigger timing (EX: master branch 有 push 事件發生時)
on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    name: Build and deploy gh-pages
    runs-on: ubuntu-latest
    env:
      MY_SECRET   : ${{secrets.GH_ACCESS_TOKEN}}
      USER_NAME   : onejar99
      USER_EMAIL  : onejar99@gmail.com
      PUBLISH_DIR : book-src/_book
    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v2.3.1
      with:
        persist-credentials: false

    - name: Build 🔧
      run: |
        echo "pwd=[$(pwd)]"
        ls -al
        cd book-src
        docker run --rm -p 4000:4000 -v $(pwd):/gitbook onejar99/gitbook:light "gitbook init && gitbook install && gitbook build"

    - name: Deploy 🚀
      uses: JamesIves/github-pages-deploy-action@3.5.7
      with:
        GITHUB_TOKEN: ${{ secrets.GH_ACCESS_TOKEN }}
        BRANCH: gh-pages
        FOLDER: $PUBLISH_DIR
      # run: |g
      #   cd $PUBLISH_DIR
      #   git init
      #   git config --local user.name $USER_NAME
      #   git config --local user.email $USER_EMAIL
      #   git status
      #   git remote add origin https://$MY_SECRET@github.com/$GITHUB_REPOSITORY.git
      #   git checkout -b gh-pages
      #   git add --all
      #   git commit -m "deploy to Github pages"
      #   git push origin gh-pages -f
      #   echo Deploy gh-pages completed! 💪💯
